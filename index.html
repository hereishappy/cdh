<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDH Productivity Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@2.0.2/build/global/luxon.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1f38 0%, #2d3a5d 100%);
            color: #fff;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.5s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .top-performer {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            position: relative;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 1.5s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { opacity: 0.2; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1.2); }
        }
        
        .congratulation-banner {
            background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        
        .progress-bar {
            height: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease-in-out;
        }
        
        .progress-fill.good {
            background: linear-gradient(90deg, #00b09b, #96c93d);
        }
        
        .progress-fill.average {
            background: linear-gradient(90deg, #f7b733, #fc4a1a);
        }
        
        .progress-fill.poor {
            background: linear-gradient(90deg, #ff512f, #dd2476);
        }
        
        .fade-in {
            animation: fadeIn 1s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.8s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .rotate-in {
            animation: rotateIn 1s ease-out;
        }
        
        @keyframes rotateIn {
            from { transform: rotate(-10deg) scale(0.9); opacity: 0; }
            to { transform: rotate(0) scale(1); opacity: 1; }
        }
        
        .dashboard-section {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
        }
        
        .dashboard-section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pulse-dot {
            width: 10px;
            height: 10px;
            background-color: #4ade80;
            border-radius: 50%;
            animation: pulse-animation 2s infinite;
        }
        
        @keyframes pulse-animation {
            0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); }
            100% { transform: scale(0.8); }
        }
        
        .ai-suggestion {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-left: 4px solid #a78bfa;
        }
        
        .ai-icon {
            font-size: 1.5rem;
            background: linear-gradient(135deg, #b721ff 0%, #21d4fd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .highlight-card {
            background: linear-gradient(135deg, #3b4fd7 0%, #6366f1 100%);
            animation: glow 3s infinite alternate;
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
            100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.8); }
        }
        
        .counter {
            font-variant-numeric: tabular-nums;
        }
        
        /* Security PIN Overlay Styles */
        .security-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1f38 0%, #2d3a5d 100%);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .security-overlay.hidden {
            opacity: 0;
            transform: translateY(-100%);
            pointer-events: none;
        }
        
        .pin-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .pin-dots {
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
            gap: 0.75rem;
        }
        
        .pin-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .pin-dot.filled {
            background: #6366f1;
            transform: scale(1.1);
        }
        
        .pin-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .pin-key {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pin-key:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .pin-key:active {
            transform: translateY(1px);
        }
        
        .pin-key.special {
            font-size: 1rem;
        }
        
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        
        .error-message {
            color: #f87171;
            font-size: 0.9rem;
            margin-top: 1rem;
            height: 20px;
            transition: opacity 0.3s ease;
        }
        
        /* Resource Cards Styles */
        .resource-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.5s ease;
            overflow: hidden;
        }
        
        .resource-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .resource-card.manpower {
            background: linear-gradient(135deg, #10b981 0%, #065f46 100%);
        }
        
        .resource-card.equipment {
            background: linear-gradient(135deg, #f59e0b 0%, #b45309 100%);
        }
        
        .resource-icon {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            margin-bottom: 1rem;
        }
        
        .resource-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .resource-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }
        
        .resource-item-icon {
            width: 30px;
            height: 30px;
            margin-right: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
        }
        
        .resource-carousel {
            display: flex;
            overflow-x: hidden;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        
        .resource-slide {
            flex: 0 0 100%;
            scroll-snap-align: start;
            transition: all 0.5s ease;
        }
        
        .carousel-dots {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .carousel-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            margin: 0 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .carousel-dot.active {
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.2);
        }
        
        .flip-card {
            perspective: 1000px;
            height: 100%;
        }
        
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .flip-card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        .resource-progress-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .resource-progress-fill {
            height: 100%;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.8);
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <!-- Security PIN Overlay -->
    <div class="security-overlay" id="security-overlay">
        <div class="pin-container" id="pin-container">
            <div class="flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-400 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
                <h2 class="text-2xl font-bold">Security Access</h2>
            </div>
            <p class="text-gray-300">Enter PIN to access the dashboard</p>
            
            <div class="pin-dots" id="pin-dots">
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
            </div>
            
            <div class="error-message" id="error-message"></div>
            
            <div class="pin-keypad">
                <div class="pin-key" data-key="1">1</div>
                <div class="pin-key" data-key="2">2</div>
                <div class="pin-key" data-key="3">3</div>
                <div class="pin-key" data-key="4">4</div>
                <div class="pin-key" data-key="5">5</div>
                <div class="pin-key" data-key="6">6</div>
                <div class="pin-key" data-key="7">7</div>
                <div class="pin-key" data-key="8">8</div>
                <div class="pin-key" data-key="9">9</div>
                <div class="pin-key special" data-key="clear">Clear</div>
                <div class="pin-key" data-key="0">0</div>
                <div class="pin-key special" data-key="enter">Enter</div>
            </div>
        </div>
    </div>

    <div class="container mx-auto">
        <!-- Header -->
        <header class="mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold mb-2 slide-in">CDH Productivity Dashboard</h1>
                    <p class="text-gray-300 mb-2 slide-in" id="current-date">Loading date...</p>
                    <p class="text-sm text-gray-400 slide-in">Sheet: PRODUCTIVITY</p>
                </div>
                <div class="mt-4 md:mt-0 rotate-in">
                    <div class="bg-indigo-600 px-4 py-2 rounded-lg shadow-lg flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        <span>LIVE UPDATES</span>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Key Metrics Highlight -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 fade-in">
            <div class="highlight-card p-5 rounded-xl flex items-center justify-between">
                <div>
                    <h3 class="text-sm font-medium text-indigo-200">TEAM AVERAGE PRODUCTIVITY</h3>
                    <p class="text-3xl font-bold counter" id="team-avg-productivity">0.00</p>
                </div>
                <div class="text-4xl">📈</div>
            </div>
            <div class="highlight-card p-5 rounded-xl flex items-center justify-between">
                <div>
                    <h3 class="text-sm font-medium text-indigo-200">TOTAL MANHOURS</h3>
                    <p class="text-3xl font-bold counter" id="team-total-manhours">0.00</p>
                </div>
                <div class="text-4xl">⏱️</div>
            </div>
        </div>
        
        <div class="refresh-indicator">
            <div class="pulse-dot"></div>
            <span id="refresh-text">Auto-refreshing hourly</span>
        </div>
        
        <!-- Top Performer Banner -->
        <div id="top-performer-banner" class="congratulation-banner p-4 rounded-xl mb-8 hidden">
            <div class="flex flex-col md:flex-row items-center justify-between">
                <div class="flex items-center mb-4 md:mb-0">
                    <div class="text-4xl mr-4">🏆</div>
                    <div>
                        <h3 class="text-xl font-bold">Congratulations!</h3>
                        <p id="top-performer-name" class="text-white text-opacity-90"></p>
                    </div>
                </div>
                <div>
                    <span class="bg-white bg-opacity-30 px-4 py-2 rounded-full font-semibold">Top Performer</span>
                </div>
            </div>
        </div>
        
        <!-- Scaffolding Resources Section -->
        <div class="dashboard-section mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 6H21M3 12H21M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M4 3V21M12 3V21M20 3V21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Scaffolding Resources
            </h2>
            
            <div class="mb-4">
                <div class="resource-carousel" id="resource-carousel">
                    <!-- Manpower Slide -->
                    <div class="resource-slide p-1">
                        <div class="resource-card manpower p-5 h-full">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">Scaffolding Team</h3>
                                <div class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                                    37 Personnel
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="resource-item">
                                    <div class="resource-item-icon">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M6 21V19C6 17.9391 6.42143 16.9217 7.17157 16.1716C7.92172 15.4214 8.93913 15 10 15H14C15.0609 15 16.0783 15.4214 16.8284 16.1716C17.5786 16.9217 18 17.9391 18 19V21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M19 8H20M4 8H5M12 1V2" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Scaffolders</h4>
                                        <p class="text-xs text-green-100">30 personnel</p>
                                    </div>
                                </div>
                                
                                <div class="resource-item">
                                    <div class="resource-item-icon">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M6 21V19C6 17.9391 6.42143 16.9217 7.17157 16.1716C7.92172 15.4214 8.93913 15 10 15H14C15.0609 15 16.0783 15.4214 16.8284 16.1716C17.5786 16.9217 18 17.9391 18 19V21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M12 4L12 2M18 8L20 8M4 8L6 8" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Supervisors</h4>
                                        <p class="text-xs text-green-100">4 personnel</p>
                                    </div>
                                </div>
                                
                                <div class="resource-item">
                                    <div class="resource-item-icon">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M6 21V19C6 17.9391 6.42143 16.9217 7.17157 16.1716C7.92172 15.4214 8.93913 15 10 15H14C15.0609 15 16.0783 15.4214 16.8284 16.1716C17.5786 16.9217 18 17.9391 18 19V21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M9 9H9.01M15 9H15.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M9 15L15 21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Safety Officer</h4>
                                        <p class="text-xs text-green-100">1 personnel</p>
                                    </div>
                                </div>
                                
                                <div class="resource-item">
                                    <div class="resource-item-icon">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M14 3V7C14 7.26522 14.1054 7.51957 14.2929 7.70711C14.4804 7.89464 14.7348 8 15 8H19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M17 21H7C6.46957 21 5.96086 20.7893 5.58579 20.4142C5.21071 20.0391 5 19.5304 5 19V5C5 4.46957 5.21071 3.96086 5.58579 3.58579C5.96086 3.21071 6.46957 3 7 3H14L19 8V19C19 19.5304 18.7893 20.0391 18.4142 20.4142C18.0391 20.7893 17.5304 21 17 21Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M9 9H10M9 13H15M9 17H15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Planner</h4>
                                        <p class="text-xs text-green-100">1 personnel</p>
                                    </div>
                                </div>
                                
                                <div class="resource-item">
                                    <div class="resource-item-icon">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M16 6L18 8L22 4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M8 14H10C10.5304 14 11.0391 14.2107 11.4142 14.5858C11.7893 14.9609 12 15.4696 12 16V19C12 19.5304 11.7893 20.0391 11.4142 20.4142C11.0391 20.7893 10.5304 21 10 21H8C7.46957 21 6.96086 20.7893 6.58579 20.4142C6.21071 20.0391 6 19.5304 6 19V16C6 15.4696 6.21071 14.9609 6.58579 14.5858C6.96086 14.2107 7.46957 14 8 14Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M14 14H16C16.5304 14 17.0391 14.2107 17.4142 14.5858C17.7893 14.9609 18 15.4696 18 16V19C18 19.5304 17.7893 20.0391 17.4142 20.4142C17.0391 20.7893 16.5304 21 16 21H14C13.4696 21 12.9609 20.7893 12.5858 20.4142C12.2107 20.0391 12 19.5304 12 19V16C12 15.4696 12.2107 14.9609 12.5858 14.5858C12.9609 14.2107 13.4696 14 14 14Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M6 10V4C6 3.46957 6.21071 2.96086 6.58579 2.58579C6.96086 2.21071 7.46957 2 8 2H16C16.5304 2 17.0391 2.21071 17.4142 2.58579C17.7893 2.96086 18 3.46957 18 4V10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Winger Driver</h4>
                                        <p class="text-xs text-green-100">1 personnel</p>
                                    </div>
                                </div>
                                
                                <div class="resource-item">
                                    <div class="resource-item-icon">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M16 3H1V16H16V3Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M16 8H20L23 11V16H16V8Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <circle cx="5.5" cy="18.5" r="2.5" stroke="white" stroke-width="2"/>
                                            <circle cx="18.5" cy="18.5" r="2.5" stroke="white" stroke-width="2"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h4 class="font-medium">Truck Driver</h4>
                                        <p class="text-xs text-green-100">1 personnel</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h4 class="text-sm font-medium mb-2">Team Allocation</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                                    <div>
                                        <div class="text-xs mb-1">Area A: 12 personnel</div>
                                        <div class="resource-progress-bar">
                                            <div class="resource-progress-fill" style="width: 32%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs mb-1">Area B: 15 personnel</div>
                                        <div class="resource-progress-bar">
                                            <div class="resource-progress-fill" style="width: 41%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs mb-1">Area C: 10 personnel</div>
                                        <div class="resource-progress-bar">
                                            <div class="resource-progress-fill" style="width: 27%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Equipment Slide -->
                    <div class="resource-slide p-1">
                        <div class="resource-card equipment p-5 h-full">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold">Equipment & Logistics</h3>
                                <div class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                                    Active Fleet
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="bg-yellow-800 bg-opacity-50 p-4 rounded-xl">
                                    <div class="flex items-center mb-3">
                                        <svg class="w-10 h-10 mr-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <rect x="2" y="4" width="20" height="2" rx="1" fill="white"/>
                                            <rect x="2" y="10" width="20" height="2" rx="1" fill="white"/>
                                            <rect x="2" y="16" width="20" height="2" rx="1" fill="white"/>
                                        </svg>
                                        <div>
                                            <h4 class="font-medium">Scaffolding Materials</h4>
                                            <p class="text-xs text-yellow-100">300 MT</p>
                                        </div>
                                    </div>
                                    <div class="text-xs space-y-1">
                                        <div class="flex justify-between">
                                            <span>Tubes:</span>
                                            <span>120 MT (40%)</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Ledgers:</span>
                                            <span>90 MT (30%)</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Boards:</span>
                                            <span>60 MT (20%)</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Fittings:</span>
                                            <span>30 MT (10%)</span>
                                        </div>
                                    </div>
                                    <div class="resource-progress-bar mt-3">
                                        <div class="resource-progress-fill" style="width: 65%"></div>
                                    </div>
                                    <p class="text-xs text-right mt-1">65% utilized (195 MT in use)</p>
                                </div>
                                
                                <div class="bg-yellow-800 bg-opacity-50 p-4 rounded-xl">
                                    <div class="flex items-center mb-3">
                                        <svg class="w-10 h-10 mr-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M16 3H1V16H16V3Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M16 8H20L23 11V16H16V8Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <circle cx="5.5" cy="18.5" r="2.5" stroke="white" stroke-width="2"/>
                                            <circle cx="18.5" cy="18.5" r="2.5" stroke="white" stroke-width="2"/>
                                        </svg>
                                        <div>
                                            <h4 class="font-medium">Material Truck</h4>
                                            <p class="text-xs text-yellow-100">1 vehicle</p>
                                        </div>
                                    </div>
                                    <div class="text-xs space-y-1">
                                        <div class="flex justify-between">
                                            <span>Status:</span>
                                            <span class="font-medium text-green-300">Operational</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Last Maintenance:</span>
                                            <span>3 days ago</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Daily Trips:</span>
                                            <span>4-6 trips</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-800 bg-opacity-50 p-4 rounded-xl">
                                    <div class="flex items-center mb-3">
                                        <svg class="w-10 h-10 mr-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 4L12 20" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M4 12L20 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <circle cx="12" cy="12" r="9" stroke="white" stroke-width="2"/>
                                            <path d="M12 17V17.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M12 7V7.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M7 12H7.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M17 12H17.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        <div>
                                            <h4 class="font-medium">Winger Vehicle</h4>
                                            <p class="text-xs text-yellow-100">1 vehicle</p>
                                        </div>
                                    </div>
                                    <div class="text-xs space-y-1">
                                        <div class="flex justify-between">
                                            <span>Status:</span>
                                            <span class="font-medium text-green-300">Operational</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Last Maintenance:</span>
                                            <span>1 week ago</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Daily Usage:</span>
                                            <span>8-10 hours</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-800 bg-opacity-50 p-4 rounded-xl">
                                    <div class="flex items-center mb-3">
                                        <svg class="w-10 h-10 mr-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 8V16" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M8 12L16 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <rect x="2" y="6" width="20" height="12" rx="2" stroke="white" stroke-width="2"/>
                                            <path d="M6 18V20" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M18 18V20" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        <div>
                                            <h4 class="font-medium">Safety Equipment</h4>
                                            <p class="text-xs text-yellow-100">40 sets</p>
                                        </div>
                                    </div>
                                    <div class="text-xs space-y-1">
                                        <div class="flex justify-between">
                                            <span>Harnesses:</span>
                                            <span>40 units</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Helmets:</span>
                                            <span>40 units</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Last Inspection:</span>
                                            <span>2 days ago</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-800 bg-opacity-50 p-4 rounded-xl">
                                    <div class="flex items-center mb-3">
                                        <svg class="w-10 h-10 mr-3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 21H21" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M5 21V7L13 3V21" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M19 21V11L13 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M9 9V9.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M9 13V13.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                            <path d="M9 17V17.01" stroke="white" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                        <div>
                                            <h4 class="font-medium">Site Facilities</h4>
                                            <p class="text-xs text-yellow-100">3 units</p>
                                        </div>
                                    </div>
                                    <div class="text-xs space-y-1">
                                        <div class="flex justify-between">
                                            <span>Storage Container:</span>
                                            <span>2 units</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Site Office:</span>
                                            <span>1 unit</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Condition:</span>
                                            <span class="font-medium text-green-300">Good</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h4 class="text-sm font-medium mb-2">Equipment Utilization</h4>
                                <div class="resource-progress-bar">
                                    <div class="resource-progress-fill" style="width: 75%"></div>
                                </div>
                                <div class="flex justify-between text-xs mt-1">
                                    <span>Current utilization</span>
                                    <span>75%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="carousel-dots mt-4">
                    <div class="carousel-dot active" data-slide="0"></div>
                    <div class="carousel-dot" data-slide="1"></div>
                </div>
            </div>
            
            <!-- Resource AI Insights -->
            <div class="card ai-suggestion p-5 mt-4">
                <div class="flex items-start">
                    <div class="mr-4">
                        <div class="ai-icon">🤖</div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium mb-2">Resource Optimization</h3>
                        <div class="text-gray-200">
                            <ul class="list-disc pl-5 space-y-2">
                                <li>Current scaffolding material utilization is at 65% (195 MT of 300 MT). Consider redistributing 20 MT from Area B to support increased work in Area C.</li>
                                <li>Team distribution analysis shows potential for 5% productivity improvement by reallocating 3 scaffolders from Area B to Area A.</li>
                                <li>Equipment maintenance schedule shows truck inspection due in 4 days. Recommend scheduling during low activity period (Sunday).</li>
                                <li>Based on current project timeline, material requirements will peak next week. Consider staging additional 30 MT of tubes and ledgers.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Summary Stats -->
        <div class="dashboard-section mb-8">
            <h2 class="text-xl font-semibold mb-4">Overall Performance</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="card p-5">
                    <h3 class="text-gray-300 text-sm mb-1">Total Erection</h3>
                    <p class="text-2xl font-bold" id="total-erection">0</p>
                </div>
                <div class="card p-5">
                    <h3 class="text-gray-300 text-sm mb-1">Total Dismantling</h3>
                    <p class="text-2xl font-bold" id="total-dismantling">0</p>
                </div>
                <div class="card p-5">
                    <h3 class="text-gray-300 text-sm mb-1">Total Equivalent</h3>
                    <p class="text-2xl font-bold" id="total-equivalent">0</p>
                </div>
                <div class="card p-5">
                    <h3 class="text-gray-300 text-sm mb-1">Target Achievement</h3>
                    <p class="text-2xl font-bold" id="target-achievement">0%</p>
                </div>
            </div>
        </div>
        
        <!-- Charts -->
        <div class="dashboard-section mb-8">
            <h2 class="text-xl font-semibold mb-4">Performance Analytics</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card p-5">
                    <h3 class="text-lg font-medium mb-4">Productivity by Supervisor</h3>
                    <div class="h-64">
                        <canvas id="productivity-chart"></canvas>
                    </div>
                </div>
                <div class="card p-5">
                    <h3 class="text-lg font-medium mb-4">Target vs Actual</h3>
                    <div class="h-64">
                        <canvas id="target-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Insights -->
        <div class="dashboard-section mb-8">
            <h2 class="text-xl font-semibold mb-4">AI Insights</h2>
            <div class="card ai-suggestion p-5">
                <div class="flex items-start">
                    <div class="mr-4">
                        <div class="ai-icon">🤖</div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium mb-2">Performance Analysis</h3>
                        <div id="ai-insights" class="text-gray-200">
                            Analyzing productivity data...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Productivity Cards -->
        <div class="dashboard-section mb-8">
            <h2 class="text-xl font-semibold mb-4">Supervisor Productivity</h2>
            <div id="productivity-cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Cards will be dynamically generated here -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let productivityData = [];
        let chartInstances = {};
        let currentResourceSlide = 0;
        let nextRefreshTime;
        
        // Security PIN
        const CORRECT_PIN = "119034";
        let currentPin = "";
        
        // CSV URL
        const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR770AQ-HHixlcLynNRlnX01iKGuoWbQjYKL4HuVkL6dkiQlneLSmavh0ol0qfNln4UTN20ZXIQ8yuY/pub?gid=67021281&single=true&output=csv';
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            updateCurrentDate();
            setupPinSecurity();
            setupResourceCarousel();
            
            // Only load data after successful PIN entry
            // loadData() will be called after PIN verification
        });
        
        // Setup PIN security
        function setupPinSecurity() {
            const pinKeys = document.querySelectorAll('.pin-key');
            const pinDots = document.querySelectorAll('.pin-dot');
            const errorMessage = document.getElementById('error-message');
            const pinContainer = document.getElementById('pin-container');
            
            pinKeys.forEach(key => {
                key.addEventListener('click', () => {
                    const keyValue = key.getAttribute('data-key');
                    
                    if (keyValue === 'clear') {
                        // Clear PIN
                        currentPin = "";
                        updatePinDots();
                        errorMessage.textContent = "";
                    } else if (keyValue === 'enter') {
                        // Verify PIN
                        if (currentPin === CORRECT_PIN) {
                            // Correct PIN
                            errorMessage.textContent = "";
                            document.getElementById('security-overlay').classList.add('hidden');
                            
                            // Initialize dashboard after successful login
                            loadData();
                            
                            // Set up auto refresh every 1 hour
                            setupAutoRefresh(60); // 60 minutes
                            
                            // Animate sections on load
                            animateSections();
                        } else {
                            // Incorrect PIN
                            errorMessage.textContent = "Incorrect PIN. Please try again.";
                            pinContainer.classList.add('shake');
                            
                            // Remove shake class after animation completes
                            setTimeout(() => {
                                pinContainer.classList.remove('shake');
                            }, 500);
                            
                            // Clear PIN
                            currentPin = "";
                            updatePinDots();
                        }
                    } else if (currentPin.length < 6) {
                        // Add digit to PIN
                        currentPin += keyValue;
                        updatePinDots();
                        
                        // Auto-submit if PIN is complete
                        if (currentPin.length === 6) {
                            setTimeout(() => {
                                document.querySelector('.pin-key[data-key="enter"]').click();
                            }, 300);
                        }
                    }
                });
            });
            
            // Update PIN dots display
            function updatePinDots() {
                pinDots.forEach((dot, index) => {
                    if (index < currentPin.length) {
                        dot.classList.add('filled');
                    } else {
                        dot.classList.remove('filled');
                    }
                });
            }
            
            // Add keyboard support for PIN entry
            document.addEventListener('keydown', (e) => {
                // Only process keyboard input if PIN overlay is visible
                if (document.getElementById('security-overlay').classList.contains('hidden')) {
                    return;
                }
                
                if (e.key >= '0' && e.key <= '9' && currentPin.length < 6) {
                    // Number keys
                    currentPin += e.key;
                    updatePinDots();
                    
                    // Auto-submit if PIN is complete
                    if (currentPin.length === 6) {
                        setTimeout(() => {
                            document.querySelector('.pin-key[data-key="enter"]').click();
                        }, 300);
                    }
                } else if (e.key === 'Enter') {
                    // Enter key
                    document.querySelector('.pin-key[data-key="enter"]').click();
                } else if (e.key === 'Backspace' || e.key === 'Delete') {
                    // Backspace/Delete key
                    currentPin = currentPin.slice(0, -1);
                    updatePinDots();
                    errorMessage.textContent = "";
                } else if (e.key === 'Escape') {
                    // Escape key
                    document.querySelector('.pin-key[data-key="clear"]').click();
                }
            });
        }
        
        // Setup resource carousel
        function setupResourceCarousel() {
            const carousel = document.getElementById('resource-carousel');
            const dots = document.querySelectorAll('.carousel-dot');
            
            // Set up dot click handlers
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => {
                    goToSlide(index);
                });
            });
            
            function goToSlide(slideIndex) {
                // Update current slide
                currentResourceSlide = slideIndex;
                
                // Scroll to the slide
                const slideWidth = carousel.offsetWidth;
                carousel.scrollTo({
                    left: slideWidth * slideIndex,
                    behavior: 'smooth'
                });
                
                // Update active dot
                dots.forEach((dot, index) => {
                    if (index === slideIndex) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
            }
        }
        
        // Update current date
        function updateCurrentDate() {
            const now = luxon.DateTime.now();
            document.getElementById('current-date').textContent = now.toFormat('EEEE, MMMM d, yyyy - hh:mm a');
        }
        
        // Setup auto refresh
        function setupAutoRefresh(minutes) {
            // Calculate next refresh time
            nextRefreshTime = new Date();
            nextRefreshTime.setMinutes(nextRefreshTime.getMinutes() + minutes);
            
            // Update refresh indicator text
            updateRefreshIndicator();
            
            // Set interval to update the countdown every minute
            setInterval(() => {
                updateRefreshIndicator();
            }, 60000); // Update every minute
            
            // Set timeout for actual refresh
            setTimeout(() => {
                loadData();
                setupAutoRefresh(minutes);
            }, minutes * 60 * 1000);
        }
        
        // Update refresh indicator
        function updateRefreshIndicator() {
            const now = new Date();
            const diffMs = nextRefreshTime - now;
            const diffMins = Math.floor(diffMs / 60000);
            
            const refreshText = document.getElementById('refresh-text');
            if (diffMins <= 0) {
                refreshText.textContent = "Refreshing now...";
            } else if (diffMins === 1) {
                refreshText.textContent = "Refreshing in 1 minute";
            } else {
                refreshText.textContent = `Refreshing in ${diffMins} minutes`;
            }
        }
        
        // Load data from CSV
        function loadData() {
            updateCurrentDate();
            
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    productivityData = results.data.map(row => {
                        return {
                            supName: row['SUP NAME'],
                            erection: parseFloat(row['ERECTION']) || 0,
                            dismantling: parseFloat(row['DISMANTLING']) || 0,
                            equivalent: parseFloat(row['EQUILVENT']) || 0,
                            totalManhours: parseFloat(row['TOTAL MANHOURS']) || 0,
                            productivity: row['PRODUCTIVITY'] === '#DIV/0!' ? 0 : parseFloat(row['PRODUCTIVITY']) || 0,
                            target: (parseFloat(row['TOTAL MANHOURS']) || 0) * 3.3
                        };
                    });
                    
                    updateDashboard();
                },
                error: function(error) {
                    console.error('Error loading CSV data:', error);
                }
            });
        }
        
        // Update the entire dashboard
        function updateDashboard() {
            updateSummaryStats();
            updateKeyMetrics();
            renderProductivityCards();
            updateCharts();
            generateAIInsights();
            highlightTopPerformer();
        }
        
        // Update key metrics at the top
        function updateKeyMetrics() {
            // Calculate team average productivity (excluding zero/invalid values)
            const validProductivity = productivityData.filter(item => item.productivity > 0);
            const avgProductivity = validProductivity.length > 0 
                ? validProductivity.reduce((sum, item) => sum + item.productivity, 0) / validProductivity.length
                : 0;
            
            // Calculate total manhours
            const totalManhours = productivityData.reduce((sum, item) => sum + item.totalManhours, 0);
            
            // Animate the counters
            animateCounter('team-avg-productivity', avgProductivity, 2);
            animateCounter('team-total-manhours', totalManhours, 2);
        }
        
        // Animate counter from 0 to target value
        function animateCounter(elementId, targetValue, decimals = 0) {
            const element = document.getElementById(elementId);
            const startValue = 0;
            const duration = 1500; // ms
            const startTime = performance.now();
            
            function updateCounter(currentTime) {
                const elapsedTime = currentTime - startTime;
                const progress = Math.min(elapsedTime / duration, 1);
                
                const currentValue = startValue + progress * (targetValue - startValue);
                element.textContent = currentValue.toFixed(decimals);
                
                if (progress < 1) {
                    requestAnimationFrame(updateCounter);
                } else {
                    element.textContent = targetValue.toFixed(decimals);
                }
            }
            
            requestAnimationFrame(updateCounter);
        }
        
        // Update summary statistics
        function updateSummaryStats() {
            const totalErection = productivityData.reduce((sum, item) => sum + item.erection, 0);
            const totalDismantling = productivityData.reduce((sum, item) => sum + item.dismantling, 0);
            const totalEquivalent = productivityData.reduce((sum, item) => sum + item.equivalent, 0);
            const totalTarget = productivityData.reduce((sum, item) => sum + item.target, 0);
            
            // Calculate target achievement percentage
            const targetAchievement = totalTarget > 0 ? (totalEquivalent / totalTarget) * 100 : 0;
            
            document.getElementById('total-erection').textContent = totalErection.toFixed(2);
            document.getElementById('total-dismantling').textContent = totalDismantling.toFixed(2);
            document.getElementById('total-equivalent').textContent = totalEquivalent.toFixed(2);
            document.getElementById('target-achievement').textContent = `${targetAchievement.toFixed(1)}%`;
        }
        
        // Render productivity cards
        function renderProductivityCards() {
            const cardsContainer = document.getElementById('productivity-cards');
            cardsContainer.innerHTML = '';
            
            productivityData.forEach((item, index) => {
                if (item.supName.trim() === '') return;
                
                const productivityPercentage = item.totalManhours > 0 
                    ? (item.equivalent / item.target) * 100 
                    : 0;
                
                const statusClass = productivityPercentage >= 90 ? 'good' : 
                                   productivityPercentage >= 70 ? 'average' : 'poor';
                
                const isTopPerformer = item.productivity > 0 && 
                    item.productivity === Math.max(...productivityData.map(d => d.productivity > 0 ? d.productivity : 0));
                
                const card = document.createElement('div');
                card.className = `card p-5 ${isTopPerformer ? 'top-performer' : ''}`;
                
                // Add stars for top performer
                if (isTopPerformer && item.productivity > 0) {
                    for (let i = 0; i < 5; i++) {
                        const star = document.createElement('div');
                        star.className = 'star';
                        star.style.width = `${Math.random() * 4 + 2}px`;
                        star.style.height = star.style.width;
                        star.style.top = `${Math.random() * 100}%`;
                        star.style.left = `${Math.random() * 100}%`;
                        star.style.animationDelay = `${Math.random() * 2}s`;
                        card.appendChild(star);
                    }
                }
                
                let productivityDisplay = item.productivity;
                if (item.productivity === 0 && item.totalManhours === 0) {
                    productivityDisplay = 'N/A';
                } else {
                    productivityDisplay = item.productivity.toFixed(2);
                }
                
                card.innerHTML += `
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="text-lg font-semibold">${item.supName}</h3>
                        <div class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm">
                            Productivity: ${productivityDisplay}
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-xs text-gray-300">Erection</p>
                            <p class="text-lg font-medium">${item.erection.toFixed(2)}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-300">Dismantling</p>
                            <p class="text-lg font-medium">${item.dismantling.toFixed(2)}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-300">Equivalent</p>
                            <p class="text-lg font-medium">${item.equivalent.toFixed(2)}</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-300">Manhours</p>
                            <p class="text-lg font-medium">${item.totalManhours.toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="mb-1 flex justify-between text-xs">
                        <span>Target: ${item.target.toFixed(2)}</span>
                        <span>${productivityPercentage.toFixed(0)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill ${statusClass}" style="width: ${Math.min(100, productivityPercentage)}%"></div>
                    </div>
                `;
                
                cardsContainer.appendChild(card);
            });
        }
        
        // Update charts
        function updateCharts() {
            updateProductivityChart();
            updateTargetChart();
        }
        
        // Update productivity chart
        function updateProductivityChart() {
            const ctx = document.getElementById('productivity-chart').getContext('2d');
            
            // Filter out supervisors with no productivity
            const filteredData = productivityData.filter(item => 
                item.supName.trim() !== '' && 
                !(item.productivity === 0 && item.totalManhours === 0)
            );
            
            // Destroy previous chart instance if exists
            if (chartInstances.productivity) {
                chartInstances.productivity.destroy();
            }
            
            chartInstances.productivity = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: filteredData.map(item => item.supName),
                    datasets: [{
                        label: 'Productivity',
                        data: filteredData.map(item => item.productivity),
                        backgroundColor: 'rgba(129, 140, 248, 0.7)',
                        borderColor: 'rgba(129, 140, 248, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }
        
        // Update target vs actual chart
        function updateTargetChart() {
            const ctx = document.getElementById('target-chart').getContext('2d');
            
            // Filter out supervisors with no data
            const filteredData = productivityData.filter(item => 
                item.supName.trim() !== '' && 
                item.totalManhours > 0
            );
            
            // Destroy previous chart instance if exists
            if (chartInstances.target) {
                chartInstances.target.destroy();
            }
            
            chartInstances.target = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: filteredData.map(item => item.supName),
                    datasets: [
                        {
                            label: 'Target',
                            data: filteredData.map(item => item.target),
                            backgroundColor: 'rgba(167, 139, 250, 0.5)',
                            borderColor: 'rgba(167, 139, 250, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Actual Equivalent',
                            data: filteredData.map(item => item.equivalent),
                            backgroundColor: 'rgba(79, 209, 197, 0.7)',
                            borderColor: 'rgba(79, 209, 197, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            }
                        }
                    }
                }
            });
        }
        
        // Generate AI insights
        function generateAIInsights() {
            const insightsElement = document.getElementById('ai-insights');
            
            // Filter valid data
            const validData = productivityData.filter(item => 
                item.supName.trim() !== '' && 
                item.totalManhours > 0
            );
            
            if (validData.length === 0) {
                insightsElement.innerHTML = 'Insufficient data to generate insights. Please ensure supervisors have recorded manhours.';
                return;
            }
            
            // Calculate insights
            const topPerformer = validData.reduce((prev, current) => 
                (prev.productivity > current.productivity) ? prev : current
            );
            
            const avgProductivity = validData.reduce((sum, item) => sum + item.productivity, 0) / validData.length;
            
            const belowTarget = validData.filter(item => item.equivalent < item.target);
            
            // Generate insights text
            let insights = `<ul class="list-disc pl-5 space-y-2">`;
            
            if (topPerformer.productivity > 0) {
                insights += `<li><span class="font-medium">${topPerformer.supName}</span> is the top performer with a productivity of ${topPerformer.productivity.toFixed(2)}.</li>`;
            }
            
            insights += `<li>Team average productivity is ${avgProductivity.toFixed(2)}.</li>`;
            
            if (belowTarget.length > 0) {
                insights += `<li>${belowTarget.length} supervisor(s) are currently below their target equivalent.</li>`;
            }
            
            // Add recommendations
            insights += `<li class="font-medium mt-2">Recommendations:</li>`;
            
            if (avgProductivity < 2.0) {
                insights += `<li>Overall productivity is below optimal levels. Consider reviewing work processes and resource allocation.</li>`;
            }
            
            if (belowTarget.length > 0) {
                insights += `<li>Focus on supporting supervisors with lower productivity to help them reach their targets.</li>`;
            }
            
            insights += `</ul>`;
            
            insightsElement.innerHTML = insights;
        }
        
        // Highlight top performer
        function highlightTopPerformer() {
            const banner = document.getElementById('top-performer-banner');
            const nameElement = document.getElementById('top-performer-name');
            
            // Filter valid data
            const validData = productivityData.filter(item => 
                item.supName.trim() !== '' && 
                item.productivity > 0 &&
                item.totalManhours > 0
            );
            
            if (validData.length === 0) {
                banner.classList.add('hidden');
                return;
            }
            
            const topPerformer = validData.reduce((prev, current) => 
                (prev.productivity > current.productivity) ? prev : current
            );
            
            if (topPerformer.productivity > 0) {
                nameElement.textContent = `${topPerformer.supName} is leading with ${topPerformer.productivity.toFixed(2)} productivity!`;
                banner.classList.remove('hidden');
            } else {
                banner.classList.add('hidden');
            }
        }
        
        // Animate dashboard sections
        function animateSections() {
            const sections = document.querySelectorAll('.dashboard-section');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });
            
            sections.forEach(section => {
                observer.observe(section);
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'966c3db844577f95',t:'MTc1Mzc4ODE3NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
