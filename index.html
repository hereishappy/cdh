<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Reporting Dashboard</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Ticker Styles */
    header, footer {
      width: 90%; /* narrower than full page */
      background: black; /* black background */
      color: white;
      overflow: hidden;
      white-space: nowrap;
      font-size: 0.9rem;
      height: 35px;
      border-radius: 6px;
      margin: 5px auto;
    }

    .ticker-wrap {
      display: flex;
      animation: tickerMove 30s linear infinite;
    }

    .ticker-item {
      padding-right: 50px;
    }

    @keyframes tickerMove {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* Dashboard container (footer hidden) */
    .iframe-container {
      width: 100%;
      max-width: 1200px;
      height: calc(90vh - 70px);
      overflow: hidden;
      position: relative;
    }

    .iframe-container iframe {
      width: 100%;
      height: 105%;
      border: none;
      position: absolute;
      top: -30px; /* hides Looker Studio footer */
    }
  </style>
</head>
<body>

  <!-- Top Ticker -->
  <header>
    <div id="ticker-top" class="ticker-wrap">
      <span class="ticker-item">üìä Loading site info...</span>
    </div>
  </header>

  <!-- Dashboard Embed (footer hidden) -->
  <div class="iframe-container">
    <iframe 
      src="https://lookerstudio.google.com/embed/reporting/269739d7-52c4-4c55-9f98-65fa02547f85/page/p_v8ez92uavd"
      allowfullscreen
      sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox">
    </iframe>
  </div>

  <!-- Bottom Ticker -->
  <footer>
    <div id="ticker-bottom" class="ticker-wrap">
      <span class="ticker-item">‚õëÔ∏è Loading safety instructions...</span>
    </div>
  </footer>

  <script>
    let userLocation = "Unknown";
    let userRegion = "";
    let userCountry = "";
    let temperature = "";
    let windSpeed = "";
    let localTime = "";

    // Fetch Location & Weather
    async function fetchTopTickerData() {
      try {
        let locRes = await fetch("https://ipapi.co/json/");
        let locData = await locRes.json();
        userLocation = locData.city;
        userRegion = locData.region;
        userCountry = locData.country_name;

        let weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${locData.latitude}&longitude=${locData.longitude}&current_weather=true`);
        let weatherData = await weatherRes.json();
        temperature = weatherData.current_weather.temperature;
        windSpeed = weatherData.current_weather.windspeed;

        updateTopTicker();
      } catch {
        document.getElementById("ticker-top").innerHTML = "<span class='ticker-item'>‚ö†Ô∏è Unable to fetch location/weather</span>";
      }
    }

    // Time updater
    function updateTime() {
      localTime = new Date().toLocaleTimeString();
      updateTopTicker();
    }

    // Top Ticker Builder
    function updateTopTicker() {
      let updates = [
        `üìç Location: ${userLocation}, ${userRegion}, ${userCountry}`,
        `‚è∞ Local Time: ${localTime}`,
        `üå°Ô∏è Temp: ${temperature}¬∞C`,
        `üí® Wind: ${windSpeed} km/h`,
        "üöß Current Site Progress: 78% Complete",
        "üìÖ Next Review Meeting: Aug 25, 2025",
        "üå¶Ô∏è Weather Alert: Light Rain Expected"
      ];

      let ticker = document.getElementById("ticker-top");
      ticker.innerHTML = "";
      for (let i = 0; i < 2; i++) {
        updates.forEach(text => {
          let span = document.createElement("span");
          span.className = "ticker-item";
          span.textContent = text;
          ticker.appendChild(span);
        });
      }
    }

    // Bottom Ticker - AI Safety Tips (static list for now)
    function updateBottomTicker() {
      let safetyTips = [
        "‚õëÔ∏è Always wear your safety helmet on site.",
        "üöß Keep walkways clear of debris to prevent trips.",
        "‚ö° Inspect electrical tools before each use.",
        "ü¶∫ Wear high-visibility vests at all times.",
        "üìè Maintain safe distances from machinery.",
        "üõ†Ô∏è Use the right tool for the job.",
        "üö® Report unsafe conditions immediately."
      ];

      let ticker = document.getElementById("ticker-bottom");
      ticker.innerHTML = "";
      for (let i = 0; i < 2; i++) {
        safetyTips.forEach(text => {
          let span = document.createElement("span");
          span.className = "ticker-item";
          span.textContent = text;
          ticker.appendChild(span);
        });
      }
    }

    // Init
    fetchTopTickerData();
    updateBottomTicker();

    // Update time every second
    setInterval(updateTime, 1000);

    // Refresh weather every 30 mins
    setInterval(fetchTopTickerData, 1800000);

    // Refresh safety tips every hour
    setInterval(updateBottomTicker, 3600000);
  </script>

</body>
</html>
